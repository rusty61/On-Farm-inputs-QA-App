<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Spray Application {{ application.id }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet">
    <style>
      :root{
        --agri-blue:#0b6ef5;
        --agri-green:#00c853;
        --ink:#222;
        --muted:#666;
        --table-border:#e5e7eb;
        --thead-bg:#eef5ff;
      }

      /* ===== Screen (flashy) ===== */
      @media screen {
        body {
          font-family: 'Inter', Arial, sans-serif;
          font-size: 13px;
          color: var(--ink);
          background: #f9fafb;
          margin: 0;
          padding: 20px;
        }
        header {
          margin-bottom: 20px;
          color: white;
          border-radius: 6px;
          padding: 16px;
          background: linear-gradient(90deg, var(--agri-blue), var(--agri-green));
          box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }
        h1 { margin: 0; font-size: 22px; font-weight: 600; }
        .meta { display:flex; justify-content:space-between; align-items:flex-start; gap:16px; }

        table {
          width: 100%;
          border-collapse: collapse;
          margin-bottom: 20px;
          background: white;
          border-radius: 6px;
          overflow: hidden;
          box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        th, td { border: 1px solid var(--table-border); padding: 8px 10px; text-align: left; }
        th { background: var(--thead-bg); font-weight: 600; }

        .section-title {
          font-size: 15px; margin: 28px 0 10px; font-weight: 600;
          border-left: 5px solid var(--agri-blue); padding-left: 8px; color: var(--agri-blue);
        }
        .highlight-box {
          background:#fff; border-left:4px solid var(--agri-green); padding:10px 12px;
          border-radius:6px; box-shadow:0 1px 2px rgba(0,0,0,0.05);
        }

        .watermark {
          position: fixed; top: 40%; left: 12%;
          font-size: 56px; font-weight: 600;
          background: linear-gradient(90deg, var(--agri-blue), var(--agri-green));
          -webkit-background-clip: text; -webkit-text-fill-color: transparent;
          opacity: 0.15; transform: rotate(-25deg); z-index: -1;
          user-select: none; pointer-events: none;
        }
        .qr { text-align:right; }
        footer { margin-top: 40px; font-size: 11px; color: var(--muted); text-align: center; }
      }

      /* ===== Print / PDF (clean) ===== */
      @media print {
        /* keep colours faithful if your renderer supports it */
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;

        html, body { background:#fff; }
        body {
          font-family: 'Inter', Arial, sans-serif;
          font-size: 11pt;
          color: #000;
          margin: 14mm 12mm; /* nice margins for A4 */
        }
        header {
          color:#000;
          padding: 0 0 8px 0;
          background: none !important;
          border-bottom: 1.5pt solid #000;
          box-shadow: none;
          border-radius: 0;
          margin-bottom: 10pt;
        }
        h1 { margin: 0; font-size: 14pt; font-weight: 600; }
        .meta { display:flex; justify-content:space-between; align-items:flex-start; }

        .section-title {
          color:#000;
          border-left: none;
          padding-left: 0;
          font-size: 12pt;
          margin: 14pt 0 6pt;
          font-weight: 600;
        }

        table {
          width:100%;
          border-collapse: collapse;
          margin-bottom: 10pt;
          background: #fff;
          box-shadow: none;
          page-break-inside: auto;
        }
        thead { display: table-header-group; }
        tfoot { display: table-footer-group; }
        tr, img { page-break-inside: avoid; }
        th, td {
          border: 0.5pt solid #000;
          padding: 5pt 6pt;
          text-align: left;
        }
        th { background: #fff; font-weight: 600; }

        .highlight-box {
          border: 0.75pt solid #000;
          border-left-width: 0.75pt;
          padding: 6pt 7pt;
          border-radius: 0;
          box-shadow: none;
          background: #fff;
        }

        .watermark {
          position: fixed;
          top: 45%;
          left: 10%;
          font-size: 40pt;
          color: #000;
          opacity: 0.06;        /* faint so text stays legible */
          transform: rotate(-25deg);
          z-index: -1;
        }

        .qr img { max-height: 28mm; }
        .qr div { font-size: 8pt; color:#000; }

        footer {
          position: fixed;
          bottom: 10mm;
          left: 0; right: 0;
          text-align: center;
          font-size: 9pt;
          color: #000;
        }

        /* Optional: show link URLs on print (uncomment to use) */
        /* a[href]:after { content: " (" attr(href) ")"; font-size: 8pt; } */
      }
    </style>
  </head>
  <body>
    <div class="watermark">AgriNet Record</div>

    <header>
      <div class="meta">
        <div>
          <h1>{{ owner.name or 'Owner' }}</h1>
          <p>
            Application ID: {{ application.id }}<br />
            Started: {{ application.started_at }}<br />
            Finalized: {{ 'Yes' if application.finalized else 'No' }}
          </p>
        </div>
        {% if qr_code %}
        <div class="qr">
          <img src="{{ qr_code }}" alt="QR code" />
          {% if record_url %}
          <div>{{ record_url }}</div>
          {% endif %}
        </div>
        {% endif %}
      </div>
    </header>

    <h2 class="section-title">Paddocks</h2>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Latitude</th>
          <th>Longitude</th>
          <th>Accuracy (m)</th>
          <th>Captured</th>
        </tr>
      </thead>
      <tbody>
        {% for paddock in paddocks %}
        <tr>
          <td>{{ paddock.name }}</td>
          <td>{{ paddock.gps_latitude or '-' }}</td>
          <td>{{ paddock.gps_longitude or '-' }}</td>
          <td>{{ paddock.gps_accuracy_m or '-' }}</td>
          <td>{{ paddock.gps_captured_at or '-' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <h2 class="section-title">Weather Snapshot</h2>
    <div class="highlight-box">
      <table>
        <tbody>
          <tr><th>Wind Speed (m/s)</th><td>{{ weather.wind_speed_ms or 'n/a' }}</td></tr>
          <tr><th>Wind Direction (°)</th><td>{{ weather.wind_direction_deg or 'n/a' }}</td></tr>
          <tr><th>Temperature (°C)</th><td>{{ weather.temp_c or 'n/a' }}</td></tr>
          <tr><th>Humidity (%)</th><td>{{ weather.humidity_pct or 'n/a' }}</td></tr>
        </tbody>
      </table>
    </div>

    <h2 class="section-title">Notes</h2>
    <div class="highlight-box">
      <p>{{ application.notes or '—' }}</p>
    </div>

    <footer>
      <p>Generated at {{ generated_at }} UTC</p>
    </footer>
  </body>
</html>
